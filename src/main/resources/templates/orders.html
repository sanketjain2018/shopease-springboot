<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<body  th:replace="~{layout :: layout(~{::section})}">

<section>

<style>
    .order-row {
        background: #fff;
        border-radius: 10px;
        padding: 10px 14px;
        margin-bottom: 8px;
        box-shadow: 0 6px 14px rgba(0,0,0,0.06);
        font-size: 0.9rem;
    }

    .badge-id {
        background: #e7f1ff;
        color: #0d6efd;
    }

    .badge-amount {
        background: #e8fff3;
        color: #198754;
    }

    .badge-placed { background: #0d6efd; color: #fff; }
    .badge-shipped { background: #ffc107; color:#000; }
    .badge-delivered { background: #198754; color:#fff; }
    .badge-cancelled { background: #dc3545; color:#fff; }

    .timeline-icons i {
        font-size: 14px;
        margin-right: 6px;
        color: #adb5bd;
    }

    .timeline-icons .done {
        color: #198754;
    }
</style>

<div class="container py-3">

    <h5 class="fw-bold mb-3">ðŸ“¦ My Orders</h5>

    <!-- EMPTY STATE -->
    <div th:if="${#lists.isEmpty(orders)}"
         class="alert alert-info text-center py-4">
        You have not placed any orders yet.
        <div class="mt-2">
            <a th:href="@{/shop}" class="btn btn-sm btn-primary">
                Start Shopping
            </a>
        </div>
    </div>

    <!-- ORDERS LIST -->
    <div th:each="order : ${orders}" class="order-row">

        <div class="row align-items-center g-2">

            <!-- ORDER ID -->
            <div class="col-md-2">
                <span class="badge badge-id">
                    ORDER #<span th:text="${order.id}"></span>
                </span>
            </div>

            <!-- DATE (NULL SAFE) -->
            <div class="col-md-2 text-muted">
                <i class="bi bi-calendar"></i>
                <span th:text="${order.orderDate != null ? #temporals.format(order.orderDate,'dd MMM yyyy') : 'N/A'}"></span>
            </div>

            <!-- TIMELINE -->
            <div class="col-md-3 timeline-icons">
                <i class="bi bi-bag-check done"></i>

                <i class="bi bi-truck"
                   th:classappend="${order.status != null and (order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED')} ? ' done' : ''"></i>

                <i class="bi bi-house-check"
                   th:classappend="${order.status != null and order.status.name() == 'DELIVERED'} ? ' done' : ''"></i>
            </div>

            <!-- AMOUNT -->
            <div class="col-md-2">
                <span class="badge badge-amount">
                    â‚¹<span th:text="${order.totalAmount}"></span>
                </span>
            </div>

            <!-- STATUS BADGE -->
            <div class="col-md-1">
                <span class="badge"
                      th:text="${order.status != null ? order.status.name() : 'UNKNOWN'}"
                      th:classappend="
                        ${order.status != null and order.status.name() == 'PLACED'} ? ' badge-placed' :
                        (${order.status != null and order.status.name() == 'SHIPPED'} ? ' badge-shipped' :
                        (${order.status != null and order.status.name() == 'DELIVERED'} ? ' badge-delivered' : ' badge-cancelled'))">
                </span>
            </div>

            <!-- ACTIONS -->
            <div class="col-md-2 text-end">
                <a th:href="@{/user/orders/{id}(id=${order.id})}"
                   class="btn btn-outline-primary btn-sm">
                    View
                </a>

                <form th:if="${order.status != null and order.status.name() == 'PLACED'}"
                      th:action="@{/user/orders/cancel/{id}(id=${order.id})}"
                      method="post"
                      class="d-inline">
                    <button class="btn btn-outline-danger btn-sm">
                        Cancel
                    </button>
                </form>
            </div>

        </div>

    </div>

</div>

</section>

</body>
</html>
